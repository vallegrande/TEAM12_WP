{% extends "base.html" %}

{% block title %}Pago - Carnicería Pochito{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-6 text-center">Finalizar Compra</h2>

<!-- Sección del formulario de pago con ID único -->
<div id="payment-form-section">
  <div id="payment-grid" class="max-w-5xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-8 items-start">
    
    <!-- Tarjeta visual -->
    <div id="card-preview" class="order-1 md:order-1">
      <div class="relative bg-gradient-to-r from-pink-300 to-red-600 text-white rounded-2xl shadow-2xl p-6 h-64 flex flex-col justify-between">
        <div class="flex justify-between items-start">
          <div class="w-12 h-12 bg-white/20 rounded-full"></div>
          <div class="text-sm opacity-90">Válido hasta</div>
        </div>
        <div class="mt-2">
          <div class="text-lg tracking-widest font-mono card-number">1234 5678 9012 3456</div>
          <div class="flex justify-between items-center mt-4">
            <div>
              <div class="text-xs opacity-80">TITULAR</div>
              <div class="font-bold card-name">NOMBRE APELLIDO</div>
            </div>
            <div class="text-right">
              <div class="text-xs opacity-80">EXP</div>
              <div class="font-bold card-expiry">08/24</div>
            </div>
          </div>
        </div>
        <div class="absolute -bottom-6 right-6 w-24 h-24 bg-white/10 rounded-lg blur-sm" aria-hidden="true"></div>
      </div>
    </div>

    <!-- Formulario -->
    <div class="order-2 md:order-2">
      <form id="payment-form" class="bg-white p-6 rounded-xl shadow-md">
        <!-- Dirección y tipo de entrega -->
        <h3 class="text-lg font-semibold mb-3">Detalles de entrega</h3>
        <label class="block mb-2 font-semibold">Tipo de entrega</label>
        <select id="delivery-type" class="w-full p-2 border rounded mb-4 focus:outline-none focus:ring-2 focus:ring-red-300" required>
          <option value="delivery">Delivery</option>
          <option value="pickup">Recoger en tienda</option>
        </select>

        <div id="address-field">
          <label class="block mb-2 font-semibold">Dirección de entrega</label>
          <input id="address" type="text" placeholder="Ej. Av. Los Álamos 123, Lima" class="w-full p-2 border rounded mb-4 focus:outline-none focus:ring-2 focus:ring-red-300" required>
        </div>

        <!-- Método de pago -->
        <label class="block mb-2 font-semibold">Método de pago</label>
        <select id="method" class="w-full p-2 border rounded mb-4 focus:outline-none focus:ring-2 focus:ring-red-300" required>
          <option value="card">Tarjeta de crédito</option>
          <option value="yape">Yape / Plin</option>
          <option value="cod">Pago contra entrega</option>
        </select>

        <!-- Campos de tarjeta -->
        <div id="card-fields">
          <label class="block mb-2">Titular de la tarjeta</label>
          <input id="card-name" type="text" placeholder="Nombre en la tarjeta" class="w-full p-2 border rounded mb-3 focus:outline-none focus:ring-2 focus:ring-red-300" required>

          <label class="block mb-2">Número de tarjeta</label>
          <input id="card-number" type="text" inputmode="numeric" maxlength="19" placeholder="1234 5678 9012 3456" class="w-full p-2 border rounded mb-3 font-mono tracking-widest focus:outline-none focus:ring-2 focus:ring-red-300" required>

          <div class="flex gap-4">
            <div class="flex-1">
              <label class="block mb-2">Expiración (MM/AA)</label>
              <input id="card-expiry" type="text" maxlength="5" placeholder="08/24" class="w-full p-2 border rounded mb-3 focus:outline-none focus:ring-2 focus:ring-red-300" required>
            </div>
            <div class="w-32">
              <label class="block mb-2">CVV</label>
              <input id="card-cvv" type="password" maxlength="4" placeholder="123" class="w-full p-2 border rounded mb-3 focus:outline-none focus:ring-2 focus:ring-red-300" required>
            </div>
          </div>
        </div>

        <!-- Pago Contra Entrega -->
        <div id="cod-panel" class="hidden bg-gray-50 border border-gray-200 rounded-xl p-5 mt-2 text-gray-700">
          <div class="flex items-center gap-4 mb-3">
            <img src="{{ url_for('static', filename='image/cod.png') }}" alt="Pago contra entrega" class="w-16 h-16 object-contain">
            <div>
              <h3 class="text-lg font-semibold">Pago contra entrega</h3>
              <p class="text-sm text-gray-600">Paga cuando recibas tu pedido. Aceptamos efectivo, tarjeta o Yape en el momento de la entrega.</p>
            </div>
          </div>
          <ul class="list-disc ml-6 text-sm text-gray-600 space-y-1">
            <li>Verifica tu dirección antes de confirmar.</li>
            <li>Ten el monto preparado al recibir tu pedido.</li>
            <li>El repartidor te entregará un comprobante físico.</li>
          </ul>
        </div>

        <!-- Botón de Confirmar -->
        <div class="flex justify-center">
          <button type="submit" id="confirm-button" class="w-full md:w-auto mt-4 inline-block bg-gradient-to-r from-red-500 to-pink-500 text-white py-3 px-8 rounded-lg font-bold hover:from-red-600 hover:to-pink-600 transition transform hover:scale-105 shadow-lg">
            Confirmar pedido
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Panel de Yape -->
<div id="yape-panel" class="max-w-5xl mx-auto mt-10 hidden">
  <div class="bg-white rounded-2xl shadow-2xl overflow-hidden">
    <div class="grid grid-cols-1 md:grid-cols-2">
      <div class="p-8 flex items-center justify-center">
        <div class="bg-white rounded-xl p-6 shadow-inner flex items-center justify-center">
          <img src="{{ url_for('static', filename='image/qr.jpg') }}" alt="QR Yape" class="w-56 h-56 object-contain" />
        </div>
      </div>
      <div class="p-8 flex flex-col justify-center">
        <h3 class="text-2xl font-semibold mb-2 text-gray-800">Paga con Yape / Plin</h3>
        <p class="text-gray-600 mb-4">Escanea el código QR o envía al número:</p>
        <p class="text-xl font-bold text-red-500 mb-4">+51 987 654 321</p>

        <div class="flex gap-4 items-center">
          <button id="confirm-yape" class="px-6 py-3 bg-gradient-to-r from-red-500 to-pink-500 text-white rounded-lg font-bold shadow hover:from-red-600 hover:to-pink-600 transition">He pagado</button>
          <button id="cancel-yape" class="px-4 py-3 border rounded-lg text-gray-700 hover:bg-gray-50">Volver</button>
        </div>

        <p class="text-sm text-gray-500 mt-4">Pulsa “He pagado” para confirmar y completar tu pedido.</p>
      </div>
    </div>
  </div>
</div>

<script>
(function() {
  const form = document.getElementById('payment-form');
  const method = document.getElementById('method');
  const cardPreview = document.getElementById('card-preview');
  const fields = document.getElementById('card-fields');
  const yapePanel = document.getElementById('yape-panel');
  const grid = document.getElementById('payment-grid');
  const codPanel = document.getElementById('cod-panel');
  const deliveryType = document.getElementById('delivery-type');
  const addressField = document.getElementById('address-field');
  const cancelYapeButton = document.getElementById('cancel-yape');
  const confirmYapeButton = document.getElementById('confirm-yape');

  // Evento para el botón "Volver"
  cancelYapeButton.addEventListener('click', () => {
    // Volver a la sección del formulario de pago
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  function updateVisibility() {
    fields.style.display = method.value === 'card' ? 'block' : 'none';
    cardPreview.style.display = method.value === 'card' ? 'block' : 'none';
    yapePanel.style.display = method.value === 'yape' ? 'flex' : 'none';
    grid.style.display = method.value === 'yape' ? 'none' : 'grid';
    codPanel.classList.toggle('hidden', method.value !== 'cod');
  }

  method.addEventListener('change', updateVisibility);
  deliveryType.addEventListener('change', () => {
    addressField.style.display = deliveryType.value === 'pickup' ? 'none' : 'block';
  });

  updateVisibility();

  form.addEventListener('submit', (e) => {
    e.preventDefault();
    const tipoEntrega = deliveryType.value;
    const direccion = document.getElementById('address').value.trim();

    if (tipoEntrega === 'delivery' && !direccion) {
      alert('Por favor ingresa tu dirección de entrega.');
      return;
    }

    if (method.value === 'cod') {
      alert('Pedido confirmado. Pagarás al recibir el producto. ¡Gracias por tu compra!');
    } else if (method.value === 'yape') {
      alert('Recuerda confirmar el pago en la pantalla de Yape.');
    } else {
      alert('Pago procesado correctamente. ¡Gracias por tu compra!');
    }
  });

  // Evento para el botón "He pagado"
  confirmYapeButton.addEventListener('click', () => {
    confirmYapeButton.disabled = true;
    confirmYapeButton.textContent = 'Procesando...';

    setTimeout(() => {
      alert('Pago procesado exitosamente. ¡Gracias por tu compra!');
      confirmYapeButton.disabled = false;
      confirmYapeButton.textContent = 'He pagado';
    }, 2000); 
  });
})();
</script>

{% endblock %}